#! /bin/sh
CBR='%{B-}'
CB1='%{B#FF99CC99}'
CB2='%{B#FF4E4E4E}'
CFR='%{F-}'
CF1='%{F#FF000000}'
CF2='%{F#FF99CC99}'
CF3='%{F#FFD75F5F}'
CF4='%{F#FF4E4E4E}'
LA='%{l}'
RA='%{r}'
AC='%{A:'
AB=':}'
AE='%{A}'
logo="${CFR}${CF1}${CB1}${AC}dmainmenu.sh&disown${AB}  ${AE}"
menu="${CF1}${AC}BspwmDesktopMenu${AB}  ${AE}${AC}BspwmWindowMenu${AB}  ${AE}${CF2}%{B#FF000000}%{B#FF000000}${CF4}" 
while read -r line ; do
	case $line in
	S*)
		sys_infos="${RA}${line#?}"
	;;
	C*)
        conky_infos="%{F#FF99CC99}${line#?}"
    ;;
	V*)
        volume_infos="${RA}%{F#FF99CC99} ${line#?} "
    ;;    
	T*)
		formatted=$(echo ${line#?} | cut -c1-70)
		title="${CFR} %{A2:bspc desktop -l next:}${AC}MonocleSwitcher${AB}${formatted}${AE}${AE} "
	;;
	W*)
		wm_infos="%{B#FF99CC99}"
		IFS=':'
		set -- ${line#?}
		while [ $# -gt 0 ] ; do
			item=$1
			name=${item#?}
			case $item in
			[OFU]*)
				# active desktop
				wm_infos="${wm_infos}${CF1}${AC}bspc desktop -f ${name}${AB}  ${AE}${CFR}"
			;;
			o*)
				# inactive but occupied desktop
				wm_infos="${wm_infos}${CF1}${AC}bspc desktop -f ${name}${AB}  ${AE}${CFR}"
			;;
			f*)
				# inactive desktop
				wm_infos="${wm_infos}${CF1}${AC}bspc desktop -f ${name}${AB}  ${AE}${CFR}"
			;;
			u*)
				# urgent desktop
				wm_infos="${wm_infos}${CF3}${AC}bspc desktop -f ${name}${AB} ● ${AE}${CFR}"
			;;
#			L*)
#				# layout
#				wm_infos="$wm_infos${CF2}${AC}bspc desktop -l next ${name}${AB} ${name} ${AE}${CFR}"
#			;;
			esac
			shift
		done
	;;
	esac
	printf "%s\n" "$logo $wm_infos $menu %{c}$title $sys_infos%{F#FF000000}$volume_infos ${conky_infos} %{A:dlogoutmenu:}%{A}"
done
# powerline symbols     
# workspaces ● ○
